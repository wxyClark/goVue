<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript错误处理 - 学习路径</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #444;
            margin-top: 30px;
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
        }
        h3 {
            color: #555;
            margin-top: 20px;
        }
        pre {
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            overflow-x: auto;
            font-family: "Courier New", Courier, monospace;
        }
        code {
            background-color: #f8f8f8;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: "Courier New", Courier, monospace;
        }
        .example {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
        }
        .demo {
            background-color: #e9f7fe;
            border: 1px solid #b3e5fc;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
        }
        button {
            background-color: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background-color: #0d47a1;
        }
        #log {
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            margin: 10px 0;
            font-family: "Courier New", Courier, monospace;
        }
        ul {
            padding-left: 20px;
        }
        li {
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <!-- 引入公共头部 -->
    <div id="header-placeholder"></div>

    <div class="container">
        <h1>JavaScript错误处理</h1>

        <div class="example">
            <h2>1. 错误处理的基本概念</h2>
            <p>错误处理是JavaScript中重要的编程概念，它允许我们捕获和处理程序执行过程中出现的错误，防止程序崩溃，并提供友好的错误信息。</p>
            <p>JavaScript中常见的错误类型包括：</p>
            <ul>
                <li><strong>SyntaxError</strong>：语法错误，代码不符合JavaScript语法规则</li>
                <li><strong>ReferenceError</strong>：引用错误，使用了未声明的变量或属性</li>
                <li><strong>TypeError</strong>：类型错误，变量或参数不是预期的类型</li>
                <li><strong>RangeError</strong>：范围错误，数值超出有效范围</li>
                <li><strong>URIError</strong>：URI错误，使用URI相关函数时参数不正确</li>
                <li><strong>EvalError</strong>：eval函数错误（现代JavaScript中较少使用）</li>
            </ul>
        </div>

        <div class="example">
            <h2>2. try...catch...finally语句</h2>
            <p>JavaScript提供了<code>try...catch...finally</code>语句来捕获和处理错误：</p>
            <pre><code>try {
    // 可能会抛出错误的代码
    const result = riskyOperation();
} catch (error) {
    // 捕获并处理错误
    console.error('发生错误:', error.message);
} finally {
    // 无论是否发生错误都会执行的代码
    cleanup();
}</code></pre>

            <div class="demo">
                <h3>演示：try...catch...finally</h3>
                <button onclick="demoTryCatch()">测试try...catch</button>
                <div id="log"></div>
            </div>
        </div>

        <div class="example">
            <h2>3. 错误对象</h2>
            <p>当发生错误时，JavaScript会创建一个错误对象，包含以下常用属性：</p>
            <ul>
                <li><code>name</code>：错误类型名称</li>
                <li><code>message</code>：错误描述信息</li>
                <li><code>stack</code>：错误堆栈跟踪信息</li>
            </ul>

            <pre><code>try {
    undefinedFunction();
} catch (error) {
    console.log('错误名称:', error.name);      // ReferenceError
    console.log('错误信息:', error.message);   // undefinedFunction is not defined
    console.log('错误堆栈:', error.stack);     // 显示错误发生的位置和调用栈
}</code></pre>
        </div>

        <div class="example">
            <h2>4. 自定义错误</h2>
            <p>我们可以通过继承<code>Error</code>类来创建自定义错误类型：</p>
            <pre><code>// 创建自定义错误类
class ValidationError extends Error {
    constructor(message) {
        super(message);
        this.name = 'ValidationError';
    }
}

// 使用自定义错误
try {
    const user = { age: -5 };
    if (user.age < 0) {
        throw new ValidationError('年龄不能为负数');
    }
} catch (error) {
    if (error instanceof ValidationError) {
        console.error('验证错误:', error.message);
    } else {
        console.error('其他错误:', error.message);
    }
}</code></pre>

            <div class="demo">
                <h3>演示：自定义错误</h3>
                <button onclick="demoCustomError()">测试自定义错误</button>
            </div>
        </div>

        <div class="example">
            <h2>5. 异步错误处理</h2>
            <p>在异步编程中，错误处理有不同的方式：</p>

            <h3>5.1 Promise错误处理</h3>
            <pre><code>// 使用catch()方法处理Promise错误
fetch('https://api.example.com/data')
    .then(response => response.json())
    .then(data => console.log(data))
    .catch(error => console.error('请求失败:', error));</code></pre>

            <h3>5.2 async/await错误处理</h3>
            <pre><code>// 使用try...catch处理async/await错误
async function fetchData() {
    try {
        const response = await fetch('https://api.example.com/data');
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('请求失败:', error);
        throw error; // 可以选择重新抛出错误
    }
}

fetchData();</code></pre>

            <div class="demo">
                <h3>演示：异步错误处理</h3>
                <button onclick="demoAsyncError()">测试async/await错误处理</button>
            </div>
        </div>

        <div class="example">
            <h2>6. 错误处理最佳实践</h2>
            <ul>
                <li><strong>只捕获预期的错误</strong>：不要捕获所有错误，只捕获你能处理的特定错误</li>
                <li><strong>提供有意义的错误信息</strong>：帮助开发者理解和修复问题</li>
                <li><strong>记录错误</strong>：将错误信息记录到服务器或日志系统中</li>
                <li><strong>优雅降级</strong>：当发生错误时，提供替代功能或友好的用户提示</li>
                <li><strong>避免在finally中抛出新错误</strong>：这会覆盖原有的错误</li>
                <li><strong>在异步代码中正确处理错误</strong>：确保所有异步操作的错误都能被捕获</li>
            </ul>
        </div>
    </div>

    <!-- 引入公共页脚 -->
    <div id="footer-placeholder"></div>

    <script>
        // 加载公共头部和页脚
        fetch('header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-placeholder').innerHTML = data;
                // 设置当前页面为活动状态
                document.querySelector('a[href="error-handling.html"]').classList.add('active');
            });

        fetch('footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer-placeholder').innerHTML = data;
            });

        // 演示函数
        function log(message) {
            const logElement = document.getElementById('log');
            logElement.innerHTML += new Date().toLocaleTimeString() + ' - ' + message + '<br>';
            logElement.scrollTop = logElement.scrollHeight;
        }

        function demoTryCatch() {
            log('=== 测试try...catch...finally ===');
            try {
                log('开始执行try块');
                // 模拟一个错误
                const result = 10 / 0;
                log('计算结果:', result);
            } catch (error) {
                log('捕获到错误:');
                log('错误名称:', error.name);
                log('错误信息:', error.message);
            } finally {
                log('执行finally块');
            }
            log('=== 测试结束 ===');
        }

        function demoCustomError() {
            // 创建自定义错误类
            class ValidationError extends Error {
                constructor(message) {
                    super(message);
                    this.name = 'ValidationError';
                }
            }

            try {
                const userAge = -10;
                if (userAge < 0) {
                    throw new ValidationError('年龄不能为负数');
                }
                alert('年龄有效');
            } catch (error) {
                if (error instanceof ValidationError) {
                    alert('验证错误: ' + error.message);
                } else {
                    alert('其他错误: ' + error.message);
                }
            }
        }

        async function demoAsyncError() {
            log('=== 测试异步错误处理 ===');
            try {
                log('开始异步请求');
                // 模拟一个失败的异步请求
                await new Promise((resolve, reject) => {
                    setTimeout(() => reject(new Error('请求超时')), 1000);
                });
                log('请求成功');
            } catch (error) {
                log('捕获到异步错误:');
                log('错误名称:', error.name);
                log('错误信息:', error.message);
            }
            log('=== 测试结束 ===');
        }
    </script>
</body>
</html>